#!/usr/bin/env bash
set -eu
# Normalise C\:/.../rocqworker.exe -> /cygdrive/c/.../rocqworker.exe (pas de ':')
filter='s#[[:space:]]([A-Za-z])\\:/([^ ]*rocqworker\.exe)#[ /cygdrive/\L\1/\2]#g'
if command -v coqdep.exe >/dev/null 2>&1; then
  exec "$(command -v coqdep.exe)" "$@" | sed -E "$filter"
elif command -v rocq >/dev/null 2>&1; then
  exec rocq dep "$@" | sed -E "$filter"
else
  echo "coqdep-sanitize: neither coqdep.exe nor rocq found" >&2
  exit 127
fi